@inject IJSRuntime JS
@implements IAsyncDisposable

<PageTitle>PhotoSwipe Vanilla JS Demo</PageTitle>

<div class="vanilla-js-demo">
    <div class="demo-header">
        <h1>📸 PhotoSwipe Vanilla JavaScript Demos</h1>
        <p class="lead">
            This page showcases PhotoSwipe's capabilities using pure JavaScript without Blazor's JSInterop system.
            Each demo below demonstrates different initialization patterns and features.
        </p>
    </div>

    <!-- Demo 1: Basic Gallery with DOM Elements -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>🖼️ Basic DOM Gallery</h2>
            <p>Traditional gallery initialized from DOM elements with anchor tags. PhotoSwipe reads image data from <code>href</code> and <code>data-pswp-*</code> attributes.</p>
        </div>
        <div id="gallery-basic" class="pswp-gallery pswp-gallery--basic">
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-2500.jpg"
               data-pswp-width="1875" 
               data-pswp-height="2500" 
               data-caption="Beautiful beach landscape">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-200.jpg" alt="Beach" />
            </a>
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-2500.jpg"
               data-pswp-width="1669" 
               data-pswp-height="2500"
               data-caption="Modern architectural stairs">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-200.jpg" alt="Stairs" />
            </a>
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-2500.jpg"
               data-pswp-width="2500" 
               data-pswp-height="1666"
               data-caption="Vibrant red chair against colorful wall">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-200.jpg" alt="Red Chair" />
            </a>
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/7/img-2500.jpg"
               data-pswp-width="2500" 
               data-pswp-height="1875"
               data-caption="Serene lake reflection">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/7/img-200.jpg" alt="Lake" />
            </a>
        </div>
    </section>

    <!-- Demo 2: Array-Based Gallery -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>📊 Array-Based Gallery</h2>
            <p>Gallery initialized from a JavaScript data array. This approach provides more flexibility and is perfect for dynamic content.</p>
        </div>
        <div class="demo-controls">
            <button id="btn-array-gallery" class="demo-btn">🚀 Open Array Gallery</button>
        </div>
    </section>

    <!-- Demo 3: Individual Images -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>🔍 Individual Image Lightboxes</h2>
            <p>Each image has its own PhotoSwipe instance. Useful for scattered images across a page that shouldn't be grouped together.</p>
        </div>
        <div id="gallery-individual" class="pswp-gallery pswp-gallery--individual">
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/5/img-2500.jpg"
               data-pswp-width="2500" 
               data-pswp-height="1667"
               data-caption="Mountain landscape - Individual lightbox #1">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/5/img-200.jpg" alt="Mountain 1" />
                <span class="individual-label">Individual #1</span>
            </a>
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/6/img-2500.jpg"
               data-pswp-width="2500" 
               data-pswp-height="1875"
               data-caption="Desert scene - Individual lightbox #2">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/6/img-200.jpg" alt="Desert" />
                <span class="individual-label">Individual #2</span>
            </a>
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/8/img-2500.jpg"
               data-pswp-width="1875" 
               data-pswp-height="2500"
               data-caption="Urban architecture - Individual lightbox #3">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/8/img-200.jpg" alt="Building" />
                <span class="individual-label">Individual #3</span>
            </a>
        </div>
    </section>

    <!-- Demo 4: Responsive Images -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>📱 Responsive Image Gallery</h2>
            <p>Gallery supporting responsive images with <code>srcset</code> for optimal loading on different devices and screen densities.</p>
        </div>
        <div id="gallery-responsive" class="pswp-gallery pswp-gallery--responsive">
            <a href="https://dummyimage.com/1200x800/4a90e2/fff/?text=Responsive+Image+1"
               data-pswp-width="1200" 
               data-pswp-height="800"
               data-pswp-srcset="https://dummyimage.com/600x400/4a90e2/fff/?text=600x400 600w, https://dummyimage.com/1200x800/4a90e2/fff/?text=1200x800 1200w"
               data-caption="Responsive image with srcset - loads optimal size">
                <img src="https://dummyimage.com/200x150/4a90e2/fff/?text=Thumb+1" alt="Responsive" />
                <span class="responsive-badge">📱 Responsive</span>
            </a>
            <a href="https://dummyimage.com/800x1200/e74c3c/fff/?text=Responsive+Image+2"
               data-pswp-width="800" 
               data-pswp-height="1200"
               data-pswp-srcset="https://dummyimage.com/400x600/e74c3c/fff/?text=400x600 400w, https://dummyimage.com/800x1200/e74c3c/fff/?text=800x1200 800w"
               data-caption="Another responsive image with multiple sources">
                <img src="https://dummyimage.com/150x200/e74c3c/fff/?text=Thumb+2" alt="Portrait" />
                <span class="responsive-badge">📱 Responsive</span>
            </a>
        </div>
    </section>

    <!-- Demo 5: Mixed Content -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>🎨 Mixed Content Gallery</h2>
            <p>Gallery containing both images and custom HTML slides. Demonstrates PhotoSwipe's flexibility beyond just photos.</p>
        </div>
        <div class="demo-controls">
            <button id="btn-mixed-content" class="demo-btn">🎭 Open Mixed Content Gallery</button>
        </div>
    </section>

    <!-- Demo 6: Mixed Layout Gallery (PhotoSwipe.com Style) -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>🏗️ Mixed Layout Gallery</h2>
            <p>Recreates the iconic PhotoSwipe.com homepage layout - one large prominent image with smaller images in a unified CSS Grid. Demonstrates advanced grid positioning with <code>grid-row: span 2</code>.</p>
        </div>
        <div id="gallery-mixed-layout" class="pswp-gallery pswp-gallery--mixed-layout">
            <a href="https://picsum.photos/id/1018/1600/1067"
               data-pswp-width="1600"
               data-pswp-height="1067"
               data-caption="Beautiful mountain landscape - Main featured image">
                <img src="https://picsum.photos/id/1018/400/267" alt="Mountain Landscape" />
            </a>
            <a href="https://picsum.photos/id/1015/1200/1600"
               data-pswp-width="1200"
               data-pswp-height="1600"
               data-caption="Tranquil lake reflection at sunset">
                <img src="https://picsum.photos/id/1015/300/400" alt="Lake Sunset" />
            </a>
            <a href="https://picsum.photos/id/1016/1200/1600"
               data-pswp-width="1200"
               data-pswp-height="1600"
               data-caption="Modern architectural elements and shadows">
                <img src="https://picsum.photos/id/1016/300/400" alt="Architecture" />
            </a>
            <a href="https://picsum.photos/id/1019/1600/1067"
               data-pswp-width="1600"
               data-pswp-height="1067"
               data-caption="Golden hour mountain vista">
                <img src="https://picsum.photos/id/1019/400/267" alt="Golden Mountains" />
            </a>
            <a href="https://picsum.photos/id/1020/1200/1600"
               data-pswp-width="1200"
               data-pswp-height="1600"
               data-caption="Dramatic cliff formations and coastal views">
                <img src="https://picsum.photos/id/1020/300/400" alt="Coastal Cliffs" />
            </a>
        </div>
    </section>

    <!-- Demo 7: Custom Thumbnails -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>✨ Custom Thumbnails & Animations</h2>
            <p>Gallery with custom padding, zoom animations, and enhanced thumbnail styles to demonstrate advanced customization.</p>
        </div>
        <div id="gallery-custom" class="pswp-gallery pswp-gallery--custom">
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-2500.jpg"
               data-pswp-width="1875" 
               data-pswp-height="2500"
               data-caption="Custom styled thumbnail with enhanced animations">
                <div class="custom-thumb">
                    <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/1/img-200.jpg" alt="Custom 1" />
                    <div class="custom-overlay">
                        <span class="zoom-icon">🔍</span>
                        <span class="custom-title">Custom Style</span>
                    </div>
                </div>
            </a>
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-2500.jpg"
               data-pswp-width="1669" 
               data-pswp-height="2500"
               data-caption="Another custom thumbnail with hover effects">
                <div class="custom-thumb">
                    <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/2/img-200.jpg" alt="Custom 2" />
                    <div class="custom-overlay">
                        <span class="zoom-icon">🔍</span>
                        <span class="custom-title">Enhanced UX</span>
                    </div>
                </div>
            </a>
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-2500.jpg"
               data-pswp-width="2500" 
               data-pswp-height="1666"
               data-caption="Third custom thumbnail showcasing styling flexibility">
                <div class="custom-thumb">
                    <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/3/img-200.jpg" alt="Custom 3" />
                    <div class="custom-overlay">
                        <span class="zoom-icon">🔍</span>
                        <span class="custom-title">Modern Design</span>
                    </div>
                </div>
            </a>
        </div>
    </section>

    <!-- Demo 7: Dynamic Gallery -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>⚡ Dynamic Gallery Generator</h2>
            <p>Dynamically generated gallery using PhotoSwipe's filters. Specify how many images to generate and watch the magic happen!</p>
        </div>
        <div class="demo-controls">
            <label for="dynamic-count" class="demo-label">Number of images:</label>
            <input type="number" id="dynamic-count" class="demo-input" value="8" min="1" max="50" />
            <button id="btn-dynamic-gallery" class="demo-btn">🎲 Generate Dynamic Gallery</button>
        </div>
    </section>

    <!-- Demo 8: Gallery with Captions -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>💬 Gallery with Custom Captions</h2>
            <p>Gallery featuring custom caption UI elements that display rich content below the images.</p>
        </div>
        <div id="gallery-caption" class="pswp-gallery pswp-gallery--caption">
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/7/img-2500.jpg"
               data-pswp-width="2500" 
               data-pswp-height="1875"
               data-caption="<strong>Tranquil Lake</strong><br>A peaceful lake reflecting the sky and surrounding nature. Perfect for meditation and relaxation. <em>Photo by Nature Photographer</em>">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/7/img-200.jpg" alt="Lake with Caption" />
            </a>
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/8/img-2500.jpg"
               data-pswp-width="1875" 
               data-pswp-height="2500"
               data-caption="<strong>Modern Architecture</strong><br>Clean lines and geometric patterns define this contemporary building design. Notice the interplay of light and shadow. <em>Urban Photography Collection</em>">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/8/img-200.jpg" alt="Architecture with Caption" />
            </a>
            <a href="https://cdn.photoswipe.com/photoswipe-demo-images/photos/9/img-2500.jpg"
               data-pswp-width="2500" 
               data-pswp-height="1875"
               data-caption="<strong>Golden Hour Landscape</strong><br>The magic hour when the sun creates warm, soft lighting across the landscape. This is every photographer's dream lighting condition. <em>Landscape Series #3</em>">
                <img src="https://cdn.photoswipe.com/photoswipe-demo-images/photos/9/img-200.jpg" alt="Landscape with Caption" />
            </a>
        </div>
    </section>

    <!-- Demo Status -->
    <section class="demo-section">
        <div class="demo-info">
            <h2>📊 Demo Status</h2>
            <p>Monitor the initialization and activity of all PhotoSwipe demos on this page.</p>
        </div>
        <div id="demo-status" class="demo-status">
            <div class="status-item">
                <span class="status-label">Initialization:</span>
                <span id="init-status" class="status-value">⏳ Pending</span>
            </div>
            <div class="status-item">
                <span class="status-label">Active Demos:</span>
                <span id="active-demos" class="status-value">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Console:</span>
                <span class="status-value">Check browser console for detailed logs</span>
            </div>
        </div>
    </section>
</div>

@code {
    private IJSObjectReference? _module;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await InitializeVanillaDemos();
        }
    }

    private async Task InitializeVanillaDemos()
    {
        try
        {
            // Load the collocated JavaScript module from PhotoSwipe.Demos
            _module = await JS.InvokeAsync<IJSObjectReference>("import", "./_content/PhotoSwipe.Demos/Components/Pages/VanillaJSDemo.razor.js");
            
            // Initialize PhotoSwipe demos using proper module import
            await _module.InvokeVoidAsync("initializePhotoSwipeDemos");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error initializing PhotoSwipe demos: {ex.Message}");
            
            // Update status on error
            await JS.InvokeVoidAsync("eval", @"
                const statusEl = document.getElementById('init-status');
                if (statusEl) statusEl.textContent = '❌ Failed';
                
                const activeEl = document.getElementById('active-demos');
                if (activeEl) activeEl.textContent = '0';
            ");
        }
    }

    public async ValueTask DisposeAsync()
    {
        try
        {
            if (_module != null)
            {
                // Clean up PhotoSwipe instances using the module
                await _module.InvokeVoidAsync("destroyAllInstances");
                
                // Dispose the JavaScript module
                await _module.DisposeAsync();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error during VanillaJSDemo cleanup: {ex.Message}");
        }
    }
}